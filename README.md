## Some local dependencies

### rbenv

    $ brew install rbenv

If you use RVM, you'll need to set the ruby version another way. If you used to use RVM and you want to switch, make sure you uninstall RVM first. [More info](https://github.com/rbenv/rbenv#installation).

### PostgreSQL

    $ brew install postgres

Postgres can be [started/stopped](https://robots.thoughtbot.com/starting-and-stopping-background-services-with-homebrew#brew-services) with `brew`.

### Redis

    $ brew install redis

Redis can be [started/stopped](https://robots.thoughtbot.com/starting-and-stopping-background-services-with-homebrew#brew-services) with `brew`.

## Installation

Copy the repo from Github to your local directory.

    $ git clone https://github.com/op4g/platform.git

Navigate into the application folder.

    $ cd platform

Install the appropriate ruby version, if necessary.

    $ rbenv install

Install the required gems.

    $ gem install bundler
    $ bundle

Add your local databases.

    $ rails db:create

Update your hosts file. Add these entries.

    127.0.0.1       op4g.local
    127.0.0.1       admin.op4g.local
    127.0.0.1       my.op4g.local
    127.0.0.1       testing.op4g.local
    127.0.0.1       survey.op4g.local
    127.0.0.1       api.op4g.local
    127.0.0.1       system.op4g.local
    127.0.0.1       customers.op4g.local

Add ENV vars. Create a `.env` file in the application root folder and ask another developer for their local ENV vars.

## Deploying

Create a feature branch.

    git checkout -b feature/add-new-feature

Make your changes.

Push your branch to github.

    $ git push

Create a pull request.

## Working with heroku

Set up Heroku locally.

    $ gem install heroku

Add git remotes.

    $ git remote add staging https://git.heroku.com/op4g-staging.git
    $ git remote add production https://git.heroku.com/op4g-production.git

Migrate the database.

    $ heroku run rake db:migrate

Run a database console. "\q" to quit.

    $ heroku pg:psql

Run a rails console. "exit" or "quit" to quit.

    $ heroku run rails console

Check out server logs.

    $ heroku logs

    OR

    $ heroku logs --tail

Scale the application up.

    $ heroku ps:resize web=standard-1x worker=standard-1x

Scale the application down.

    $ heroku ps:resize web=hobby worker=hobby

Get help on other commands.

    $ heroku help

## Local development

### Running the web server only

Use Rails command.

    rails s

### Running multiple processes

Use heroku.

    heroku local -p 3000
    heroku local -p 3000 web=2,worker=2

### Caching

Caching in the development environment is off by default. Toggle it on and off with this statement:

    rails dev:cache

### Mailcatcher

Use mailcatcher to view emails generated by your development environment.

Install.

    gem install mailcatcher

Run.

    mailcatcher
    < navigate to URL indicated >

## Local testing

### Minitest

Run all tests.

    rails test

Or fail on first test.

    rails test --fail-fast

## Api version

    localhost: api.op4g.localhost:3000/v1/
    test with no authenticate, check comments in code
